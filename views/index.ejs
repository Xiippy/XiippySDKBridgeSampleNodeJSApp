<% layout('./partials/mainlayout') %>
    <div class="text-center">
        <h1 class="display-4">Welcome</h1>
        <p>This is a simple payment form which show how Xiippy's basic data-rich payments can be added to a web-based
            e-commerce server with around 100 lines of code'.</p>

        <% if (Model.ErrorText) { %>
            <div class="alert alert-danger alert-dismissible fade show text-break" role="alert">
                <p><strong>Error</strong></p>
                <p> <%= Model.ErrorText%></p>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>

            <% } %>

                <div id="frameContainer" style="width:100%; margin:0 auto 0 auto; min-height:300"></div>
                <div id="diverror" style="width:100%; margin:0 auto 0 auto;"></div>
                <script src="https://cdn.xiippy.ai/PaymentScripts/app.XiippyFrameSDK.bundle.js"></script>
                <script>
                    function initXiippyFrameSDK() {

                        // initialize parameters
                        var FrameContainerID = 'frameContainer';
                        // this parameter is generated by Xiippy's server-side SDK and has to be set from the server
                        var Url = '<%- Model.XiippyFrameUrl %>';
                        var sdkInstance = new XiippyFrameSDK.XiippyFrameSDK(FrameContainerID, Url);

                        // listen for events
                        sdkInstance.on('PaymentProcessed', (eventArgs) => {
                            // you need to implement payment success logic here
                            console.log('PaymentProcessed event was fired!', eventArgs);
                        });

                        sdkInstance.on('PaymentError', (eventArgs) => {
                            // you need to implement retrying or error handling logic here!
                            console.log('PaymentError event was fired!', eventArgs);

                            document.getElementById('diverror').innerText = eventArgs?.eventArgs?.error?.message;
                        });

                    }

                    // initialize the SDK upon page load
                    window.addEventListener("load", () => initXiippyFrameSDK(), false);
                </script>
    </div>